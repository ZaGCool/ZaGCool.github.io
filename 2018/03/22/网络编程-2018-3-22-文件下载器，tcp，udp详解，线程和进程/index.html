<!DOCTYPE html><html lang="zh-cn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>文件下载器，tcp，udp详解，线程和进程 | ZaG-Blog</title><meta name="description" content="文件下载器，tcp，udp详解，线程和进程"><meta name="keywords" content="网络"><meta name="author" content="ZaG Cool"><meta name="copyright" content="ZaG Cool"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="文件下载器，tcp，udp详解，线程和进程"><meta name="twitter:description" content="文件下载器，tcp，udp详解，线程和进程"><meta name="twitter:image" content="http://q78182iho.bkt.clouddn.com/19-01-25.jpg?e=1584259601&amp;token=PEtkS6wXfPIIvWRhdNmawy45lpr8NHmUxTk0LSsj:b8PjIDuqQVkvVNV9djSpVMd8JAw=&amp;attname="><meta property="og:type" content="article"><meta property="og:title" content="文件下载器，tcp，udp详解，线程和进程"><meta property="og:url" content="http://gza8.com/2018/03/22/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-2018-3-22-%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E5%99%A8%EF%BC%8Ctcp%EF%BC%8Cudp%E8%AF%A6%E8%A7%A3%EF%BC%8C%E7%BA%BF%E7%A8%8B%E5%92%8C%E8%BF%9B%E7%A8%8B/"><meta property="og:site_name" content="ZaG-Blog"><meta property="og:description" content="文件下载器，tcp，udp详解，线程和进程"><meta property="og:image" content="http://q78182iho.bkt.clouddn.com/19-01-25.jpg?e=1584259601&amp;token=PEtkS6wXfPIIvWRhdNmawy45lpr8NHmUxTk0LSsj:b8PjIDuqQVkvVNV9djSpVMd8JAw=&amp;attname="><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '1'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://gza8.com/2018/03/22/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-2018-3-22-%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E5%99%A8%EF%BC%8Ctcp%EF%BC%8Cudp%E8%AF%A6%E8%A7%A3%EF%BC%8C%E7%BA%BF%E7%A8%8B%E5%92%8C%E8%BF%9B%E7%A8%8B/"><link rel="prev" title="进程通信，进程池以及迭代器" href="http://gza8.com/2018/03/29/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-2018-3-29-%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1%EF%BC%8C%E8%BF%9B%E7%A8%8B%E6%B1%A0%E4%BB%A5%E5%8F%8A%E8%BF%AD%E4%BB%A3%E5%99%A8/"><link rel="next" title="常见ftp，ssh搭建，网络基础知识，tcp，udp，socket编程" href="http://gza8.com/2018/03/17/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-2018-3-17-%E5%B8%B8%E8%A7%81ftp-ssh%E6%90%AD%E5%BB%BA-%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-tcp-udp-socket%E7%BC%96%E7%A8%8B/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"http://www.gza8.com/","msgToTraditionalChinese":"简","msgToSimplifiedChinese":"繁"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">ZaG-Blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avator.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">42</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">17</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">7</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">Catalog</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#案例：文件下载器"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">案例：文件下载器</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#实现步骤"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">实现步骤</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#案例：文件下载器-1"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">案例：文件下载器</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#tcp3次握手"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">tcp3次握手</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#tcp四次挥手"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">tcp四次挥手</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#wireshark抓包工具"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">wireshark抓包工具</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#多任务介绍"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">多任务介绍</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#使用threading模块"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">使用threading模块</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#线程数量"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">线程数量</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#线程名称"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text">线程名称</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#线程参数以及顺序"><span class="toc_mobile_items-number">3.4.</span> <span class="toc_mobile_items-text">线程参数以及顺序</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#线程传递参数"><span class="toc_mobile_items-number">3.5.</span> <span class="toc_mobile_items-text">线程传递参数</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#守护线程"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">守护线程</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#设置线程守护"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">设置线程守护</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#自定义线程类"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">自定义线程类</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#多线程–共享全局变量"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">多线程–共享全局变量</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#1-多个线程方法中可以共用全局变量"><span class="toc_mobile_items-number">5.1.</span> <span class="toc_mobile_items-text">1.多个线程方法中可以共用全局变量</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#多线程共享全局变量带来的问题"><span class="toc_mobile_items-number">5.2.</span> <span class="toc_mobile_items-text">多线程共享全局变量带来的问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#解决方法一-join"><span class="toc_mobile_items-number">5.3.</span> <span class="toc_mobile_items-text">解决方法一 join()</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#案例：多任务版udp聊天器"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">案例：多任务版udp聊天器</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#udp广播"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">udp广播</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#进程以及状态"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">进程以及状态</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#1-进程概念"><span class="toc_mobile_items-number">8.1.</span> <span class="toc_mobile_items-text">1.进程概念</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#2-进程的状态"><span class="toc_mobile_items-number">8.2.</span> <span class="toc_mobile_items-text">2.进程的状态</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#3-创建子进程"><span class="toc_mobile_items-number">8.3.</span> <span class="toc_mobile_items-text">3.创建子进程</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#进程名称，-pid"><span class="toc_mobile_items-number">8.4.</span> <span class="toc_mobile_items-text">进程名称， pid</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#守护进程"><span class="toc_mobile_items-number">8.5.</span> <span class="toc_mobile_items-text">守护进程</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#案例：文件下载器"><span class="toc-number">1.</span> <span class="toc-text">案例：文件下载器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#实现步骤"><span class="toc-number">1.1.</span> <span class="toc-text">实现步骤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#案例：文件下载器-1"><span class="toc-number">1.2.</span> <span class="toc-text">案例：文件下载器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tcp3次握手"><span class="toc-number">1.3.</span> <span class="toc-text">tcp3次握手</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tcp四次挥手"><span class="toc-number">1.4.</span> <span class="toc-text">tcp四次挥手</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#wireshark抓包工具"><span class="toc-number">2.</span> <span class="toc-text">wireshark抓包工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多任务介绍"><span class="toc-number">3.</span> <span class="toc-text">多任务介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#使用threading模块"><span class="toc-number">3.1.</span> <span class="toc-text">使用threading模块</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#线程数量"><span class="toc-number">3.2.</span> <span class="toc-text">线程数量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#线程名称"><span class="toc-number">3.3.</span> <span class="toc-text">线程名称</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#线程参数以及顺序"><span class="toc-number">3.4.</span> <span class="toc-text">线程参数以及顺序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#线程传递参数"><span class="toc-number">3.5.</span> <span class="toc-text">线程传递参数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#守护线程"><span class="toc-number">4.</span> <span class="toc-text">守护线程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#设置线程守护"><span class="toc-number">4.1.</span> <span class="toc-text">设置线程守护</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#自定义线程类"><span class="toc-number">4.2.</span> <span class="toc-text">自定义线程类</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多线程–共享全局变量"><span class="toc-number">5.</span> <span class="toc-text">多线程–共享全局变量</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-多个线程方法中可以共用全局变量"><span class="toc-number">5.1.</span> <span class="toc-text">1.多个线程方法中可以共用全局变量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#多线程共享全局变量带来的问题"><span class="toc-number">5.2.</span> <span class="toc-text">多线程共享全局变量带来的问题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#解决方法一-join"><span class="toc-number">5.3.</span> <span class="toc-text">解决方法一 join()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#案例：多任务版udp聊天器"><span class="toc-number">6.</span> <span class="toc-text">案例：多任务版udp聊天器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#udp广播"><span class="toc-number">7.</span> <span class="toc-text">udp广播</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#进程以及状态"><span class="toc-number">8.</span> <span class="toc-text">进程以及状态</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-进程概念"><span class="toc-number">8.1.</span> <span class="toc-text">1.进程概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-进程的状态"><span class="toc-number">8.2.</span> <span class="toc-text">2.进程的状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-创建子进程"><span class="toc-number">8.3.</span> <span class="toc-text">3.创建子进程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#进程名称，-pid"><span class="toc-number">8.4.</span> <span class="toc-text">进程名称， pid</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#守护进程"><span class="toc-number">8.5.</span> <span class="toc-text">守护进程</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(http://q78182iho.bkt.clouddn.com/19-01-25.jpg?e=1584259601&amp;token=PEtkS6wXfPIIvWRhdNmawy45lpr8NHmUxTk0LSsj:b8PjIDuqQVkvVNV9djSpVMd8JAw=&amp;attname=)"><div id="post-info"><div id="post-title"><div class="posttitle">文件下载器，tcp，udp详解，线程和进程</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> Created 2018-03-22<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> Updated 2020-03-15</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Python%E7%AC%94%E8%AE%B0/">Python笔记</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>Post View:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h4 id="案例：文件下载器"><a href="#案例：文件下载器" class="headerlink" title="案例：文件下载器"></a>案例：文件下载器</h4><h5 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h5><ol>
<li><p>客户端</p>
 <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">实现思路：</span><br><span class="line"><span class="number">1.</span>导入模块</span><br><span class="line"><span class="number">2.</span>创建套接字</span><br><span class="line"><span class="number">3.</span>建立和服务器的连接</span><br><span class="line"><span class="number">4.</span>接收用户输入的文件名</span><br><span class="line"><span class="number">5.</span>发送文件名到服务器</span><br><span class="line"><span class="number">6.</span>创建文件，准备接收服务器返回的文件数据</span><br><span class="line"><span class="number">7.</span>保存文件数据</span><br><span class="line"><span class="number">8.</span>关闭套接字</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>服务端</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">实现思路</span><br><span class="line"><span class="number">1.</span>导入模块</span><br><span class="line"><span class="number">2.</span>创建套接字</span><br><span class="line"><span class="number">3.</span>绑定地址和端口</span><br><span class="line"><span class="number">4.</span>开始监听，设置套接字为被动监听模式</span><br><span class="line"><span class="number">5.</span>等待客户端连接 （如果有客户连接 会创建新的套接字）</span><br><span class="line"><span class="number">6.</span>接收客户端发来的文件名</span><br><span class="line"><span class="number">7.</span>根据文件名进行读取文件数据</span><br><span class="line"><span class="number">8.</span>将读取的文件数据发送给客户端（循环）</span><br><span class="line"><span class="number">9.</span>关闭和客户端的连接</span><br><span class="line"><span class="number">10.</span>关闭服务器</span><br></pre></td></tr></table></figure></div>

</li>
</ol>
<h5 id="案例：文件下载器-1"><a href="#案例：文件下载器-1" class="headerlink" title="案例：文件下载器"></a>案例：文件下载器</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端</span></span><br><span class="line"><span class="comment"># 导入套接字</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建套接字</span></span><br><span class="line">tcp_server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"><span class="comment"># 设置地址重用</span></span><br><span class="line">tcp_server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 绑定端口</span></span><br><span class="line">tcp_server_socket.bind((<span class="string">""</span>, <span class="number">8000</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用服务器侦听状态</span></span><br><span class="line">tcp_server_socket.listen(<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收多客户端连接</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    new_tcp_client_socket, ip_port = tcp_server_socket.accept()</span><br><span class="line">    print(<span class="string">"【新客户端来了】"</span>, ip_port)</span><br><span class="line"></span><br><span class="line">    recv_data = new_tcp_client_socket.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        file_name = recv_data.decode()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        file_name = recv_data.decode(encoding=<span class="string">"gbk"</span>, errors=<span class="string">"ignore"</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"发来的文件名是:"</span>, file_name)</span><br><span class="line">    <span class="comment"># 根据文件名 打开对应的文件</span></span><br><span class="line">    <span class="comment"># 使用try  except</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> open(file_name, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                con = f.read(<span class="number">1024</span>)</span><br><span class="line">                <span class="keyword">if</span> con:</span><br><span class="line">                    new_tcp_client_socket.send(con)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    print(<span class="string">"客户端已经断开"</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        new_tcp_client_socket.send(<span class="string">'err：文件找不到'</span>.encode())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        new_tcp_client_socket.send(<span class="string">'suc：文件下载完'</span>.encode())</span><br><span class="line"></span><br><span class="line">    new_tcp_client_socket.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器可以不用关闭</span></span><br><span class="line"><span class="comment"># tcp_server_socket.close()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#==============</span></span><br><span class="line"><span class="comment"># 客户端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec_fun</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = data.decode()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        data = data.decode(encoding=<span class="string">"gbk"</span>, errors=<span class="string">"ignore"</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">tcp_client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">tcp_client_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="literal">True</span>)</span><br><span class="line">tcp_client_socket.connect((<span class="string">"192.168.162.163"</span>, <span class="number">8000</span>))</span><br><span class="line"></span><br><span class="line">file_name = input(<span class="string">"请输入您要下载的文件名"</span>)</span><br><span class="line">tcp_client_socket.send(file_name.encode())</span><br><span class="line"></span><br><span class="line">file_path = <span class="string">"/Users/ZaG/Desktop/test/"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(file_path + file_name, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        recv_data = tcp_client_socket.recv(<span class="number">1024</span>)</span><br><span class="line">        data = dec_fun(recv_data)</span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="keyword">if</span> data[:<span class="number">3</span>] == <span class="string">"err"</span> <span class="keyword">or</span> data[:<span class="number">3</span>] == <span class="string">"suc"</span>:</span><br><span class="line">            print(data)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> data:</span><br><span class="line">            f.write(data.encode())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">tcp_client_socket.close()</span><br></pre></td></tr></table></figure></div>



<h5 id="tcp3次握手"><a href="#tcp3次握手" class="headerlink" title="tcp3次握手"></a>tcp3次握手</h5><blockquote>
<p>标志位 SYN 连接请求 ACK 确认 FIN 关闭连接</p>
<p>序号： seq：报文序号   ack 确认号</p>
</blockquote>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tcp三次握手 就是建立tcp连接的过程，在socket编程中，由客户端执行connect来触发</span><br><span class="line">第一次握手：</span><br><span class="line">	客户端发送syn连接请求SYN=<span class="number">1</span>  随机序号seq=j  随机客户端进入syn_sent状态 等待server确认</span><br><span class="line">	(SYN=<span class="number">1</span>,seq=j)</span><br><span class="line">第二次握手：</span><br><span class="line">	服务端 接收到数据包之后， 在SYN=<span class="number">1</span>后添加确认ACK=<span class="number">1</span>，发送确认号为ack=j+<span class="number">1</span>  随机产生seq序号seq=k   进行传输</span><br><span class="line">	(SYN=<span class="number">1</span>,ACk=<span class="number">1</span>,ack=j+<span class="number">1</span>,seq=k )</span><br><span class="line">第三次握手：</span><br><span class="line">	客户端收到数据包之后， 检查ack等于j+<span class="number">1</span> ACK为<span class="number">1</span> </span><br><span class="line">    将ACK=<span class="number">1</span>确认 以及确认号ack=k+<span class="number">1</span></span><br><span class="line">    (ACK=<span class="number">1</span>,ack=k+<span class="number">1</span>)</span><br></pre></td></tr></table></figure></div>

<h5 id="tcp四次挥手"><a href="#tcp四次挥手" class="headerlink" title="tcp四次挥手"></a>tcp四次挥手</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">client --------------------server</span><br><span class="line">	FIN=1，seq=u ---&gt; 关闭连接请求 和随机序号</span><br><span class="line">    确认ACK=<span class="number">1</span>，报文序号确认ack=u+<span class="number">1</span> 随机seq&lt;---ACK=<span class="number">1</span> seq=v ack=u+<span class="number">1</span></span><br><span class="line">    &lt;----- FIN=<span class="number">1</span>，ACK=<span class="number">1</span>， seq=w  ack=u+<span class="number">1</span> </span><br><span class="line">    等待2MSL时间）    收到确认 ACK=1，seq=u+1,ack=w+1-----&gt;</span><br><span class="line">    注意：等待网络延迟产生的被动方超时重传的ACK报文</span><br></pre></td></tr></table></figure></div>

<h4 id="wireshark抓包工具"><a href="#wireshark抓包工具" class="headerlink" title="wireshark抓包工具"></a>wireshark抓包工具</h4><h4 id="多任务介绍"><a href="#多任务介绍" class="headerlink" title="多任务介绍"></a>多任务介绍</h4><blockquote>
<p>多任务处理是指用户可以在同一时间内运行多个应用程序，每个应用程序被称作一个任务  window是支持多任务的操作系统</p>
</blockquote>
<p><strong>并发</strong></p>
<blockquote>
<p>指的是任务数多于cpu核数，通过操作系统的各种任务调度算法，实现多个任务一起执行</p>
</blockquote>
<p><strong>并行</strong></p>
<blockquote>
<p>指的是任务数小于等于cpu核心数  任务真正的一起执行</p>
</blockquote>
<h5 id="使用threading模块"><a href="#使用threading模块" class="headerlink" title="使用threading模块"></a>使用threading模块</h5><p><strong>单线程执行</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">saySorry</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'我错了'</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>：</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        saySorry()</span><br></pre></td></tr></table></figure></div>

<p><strong>多线程执行</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time, threading</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">saySorry</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"亲爱的，我错了"</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"> <span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        t1 = threading.Thread(target=saySorry)</span><br><span class="line">        t1.start()</span><br><span class="line">    print(<span class="string">'我是主线程'</span>)</span><br><span class="line"><span class="comment"># 1.多线程并发操作 花费时间更少</span></span><br><span class="line"><span class="comment"># 2.当调用start() 才会真正的创建线程，并开始执行</span></span><br><span class="line"><span class="comment"># 3.每个线程都有一个唯一标识符</span></span><br><span class="line"><span class="comment"># 4.主线程 mainThread 主程序入口 </span></span><br><span class="line"><span class="comment"># 5.子线程 Thread-x 使用threading.Thread()创建</span></span><br><span class="line"><span class="comment"># 6.线程数量：主线程+子线程数</span></span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep,ctime</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sing</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        print(<span class="string">"正在唱歌...%d"</span>%i)</span><br><span class="line">        sleep(<span class="number">1</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dance</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        print(<span class="string">'正在跳舞....%d'</span>%i)</span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">'.....开始....%s'</span>%ctime())</span><br><span class="line">    </span><br><span class="line">    t1 = threading.Thread(target=sing)</span><br><span class="line">    t2 = threading.Thread(target=dance)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    print(<span class="string">'.....结束....%s'</span>%ctime())</span><br></pre></td></tr></table></figure></div>

<h5 id="线程数量"><a href="#线程数量" class="headerlink" title="线程数量"></a>线程数量</h5><p><code>threading.enumerate()</code></p>
<h5 id="线程名称"><a href="#线程名称" class="headerlink" title="线程名称"></a>线程名称</h5><p><code>threading.current_thread()</code></p>
<h5 id="线程参数以及顺序"><a href="#线程参数以及顺序" class="headerlink" title="线程参数以及顺序"></a>线程参数以及顺序</h5><blockquote>
<p>多线程的同一时间的执行顺序取决于cpu时间片轮转的调度算法，我们可以认为是随机的</p>
</blockquote>
<h5 id="线程传递参数"><a href="#线程传递参数" class="headerlink" title="线程传递参数"></a>线程传递参数</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方法1  使用args</span></span><br><span class="line">t1 = threading.Thread(target=sing, args=(<span class="number">10</span>,<span class="number">100</span>,<span class="number">1000</span>))</span><br><span class="line"><span class="comment"># 方法2  使用kwargs</span></span><br><span class="line">t1 = threading.Thread(target=sing,kwargs, kwargs=&#123;<span class="string">"a"</span>:<span class="number">10</span>, <span class="string">"b"</span>: <span class="number">100</span>, <span class="string">"c"</span>: <span class="number">1000</span>&#125;)</span><br><span class="line"><span class="comment"># 方法3 使用混合方法</span></span><br><span class="line">t1 = threading.Thread(target=sing, args=(<span class="number">10</span>,), kwargs=&#123;<span class="string">"c"</span>:<span class="number">1000</span>, <span class="string">"b"</span>: <span class="number">100</span>&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="守护线程"><a href="#守护线程" class="headerlink" title="守护线程"></a>守护线程</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        print(<span class="string">"正在执行..."</span>, i)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">"__main__"</span>:</span><br><span class="line">    t1 = threading.Thread(target=work1)</span><br><span class="line">    t1 = setDaemon(<span class="literal">True</span>)</span><br><span class="line">    t1.start()</span><br><span class="line">    </span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(<span class="string">'Game Over'</span>)</span><br><span class="line">    </span><br><span class="line">    exit()  <span class="comment"># 退出无效 有别的子线程继续执行 </span></span><br><span class="line">    <span class="comment"># 想让主线程结束的时候 没有执行完成的子线程一起结束 这就是线程守护</span></span><br></pre></td></tr></table></figure></div>

<h5 id="设置线程守护"><a href="#设置线程守护" class="headerlink" title="设置线程守护"></a>设置线程守护</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置为守护线程 （如果主线程结束了 也随之结束）</span></span><br><span class="line">线程.setDaemon(<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></div>

<h5 id="自定义线程类"><a href="#自定义线程类" class="headerlink" title="自定义线程类"></a>自定义线程类</h5><blockquote>
<p>通过自定义封装的线程类 可以实现功能扩展 </p>
</blockquote>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 继承threading.Thread</span></span><br><span class="line"><span class="comment"># 2. 重写run方法</span></span><br><span class="line"><span class="comment"># 3. 通过实例线程对象 启动线程</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="comment"># 定义构造方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.num = num</span><br><span class="line">    <span class="comment"># 重写父类的run 方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">            print(<span class="string">"正在执行run方法:"</span>, self.num)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    mythread = MyThread(<span class="number">10</span>)</span><br><span class="line">    <span class="comment"># 启动线程</span></span><br><span class="line">    mythread.start()</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>python中threading.Thread类有一个run方法，用于定义线程的功能函数，可以在自己的线程类中覆盖该方法，实现功能扩展，当线程获得启动执行时，start就会调用run方法</p>
</blockquote>
<h4 id="多线程–共享全局变量"><a href="#多线程–共享全局变量" class="headerlink" title="多线程–共享全局变量"></a>多线程–共享全局变量</h4><h5 id="1-多个线程方法中可以共用全局变量"><a href="#1-多个线程方法中可以共用全局变量" class="headerlink" title="1.多个线程方法中可以共用全局变量"></a>1.多个线程方法中可以共用全局变量</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work1</span><span class="params">(nums)</span>:</span></span><br><span class="line">    nums.append(<span class="number">44</span>)</span><br><span class="line">    print(<span class="string">"----in work1---"</span>, nums)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work2</span><span class="params">(nums)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"---in work2---"</span>, nums)</span><br><span class="line">g_nums = [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>]</span><br><span class="line">t1 = Thread(target=work1, args=(g_nums,))</span><br><span class="line">t1.start()</span><br><span class="line">t2 = Thread(target=work2, args=(g_nums,))</span><br><span class="line">t2.start()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在一个进程内的所有的线程共享全局变量 很方便在多个线程间共享数据</span></span><br><span class="line"><span class="comment"># 缺点是 线程是对全局变量随意更改，可以造成多线程之间对全局变量的混乱（即线程非安全）</span></span><br></pre></td></tr></table></figure></div>

<h5 id="多线程共享全局变量带来的问题"><a href="#多线程共享全局变量带来的问题" class="headerlink" title="多线程共享全局变量带来的问题"></a>多线程共享全局变量带来的问题</h5><blockquote>
<p>如果多个线程同时对同一全局变量操作，会出现资源竞争问题，从而数据结果会不正确</p>
</blockquote>
<h5 id="解决方法一-join"><a href="#解决方法一-join" class="headerlink" title="解决方法一 join()"></a>解决方法一 join()</h5><blockquote>
<p>join方法：一个线程在执行过程中 要调用另外一个线程，并且等到其完成以后才能接着执行</p>
</blockquote>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t1 = threading.Thread(target=test, args=(<span class="number">10000</span>, ))</span><br><span class="line">t1.start()</span><br><span class="line"><span class="comment"># t1执行完成之后在执行t2线程</span></span><br><span class="line">t1.join()</span><br></pre></td></tr></table></figure></div>



<p><strong>同步</strong>: 多任务， 多个任务之间执行的时候 要求有先后顺序，只有一个主线</p>
<p><strong>异步</strong>: 多个任务之间执行没有先后顺序，可以同时运行，执行的先后顺序不会有什么影响，存在的多条运行主线</p>
<p><a href="/img/images/pic/QQ20180909-165908@2x.png" data-fancybox="group" data-caption="QQ20180909-165908@2x" class="fancybox"><img alt="QQ20180909-165908@2x" title="QQ20180909-165908@2x" data-src="/img/images/pic/QQ20180909-165908@2x.png" src="/img/loading.gif" class="lazyload"></a></p>
<p>A线程获得了g_num 的使用权 并且加上了锁机制，此时B C线程无法使用g_nums ， B  C线程 必须等到A线程不再使用g_nums 并且解锁后，才能使用g_nums</p>
<p><strong>互斥锁</strong></p>
<p>当多个线程几乎同时修改某一个共享数据 需要同步控制</p>
<p>最简单的线程同步控制 互斥锁</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建锁</span></span><br><span class="line">mutex = threading.Lock()</span><br><span class="line"><span class="comment"># 锁定</span></span><br><span class="line">mutex.acquire()</span><br><span class="line"><span class="comment"># 释放</span></span><br><span class="line">mutex.release()</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>总结：</p>
<p>好处：确保了某段关键代码只能由一个线程从头到尾完整的执行</p>
<p>坏处：阻止了多线程并发执行，包含锁的某段代码实际上只能以单线程模式执行，效率就大大的下降了</p>
<p>由于可以存在多个锁，不同的线程持有多个锁，试图获取对象持有的锁时，可能会造成死锁</p>
</blockquote>
<h4 id="案例：多任务版udp聊天器"><a href="#案例：多任务版udp聊天器" class="headerlink" title="案例：多任务版udp聊天器"></a>案例：多任务版udp聊天器</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec_fun</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = data.decode()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        data = data.decode(encoding=<span class="string">"gbk"</span>, errors=<span class="string">"ignore"</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_fun</span><span class="params">(server)</span>:</span></span><br><span class="line"></span><br><span class="line">    ip = input(<span class="string">"请输入您要发的ip地址："</span>) <span class="keyword">or</span> <span class="string">"192.168.162.61"</span></span><br><span class="line"></span><br><span class="line">    port = int(input(<span class="string">"请输入您要发的端口："</span>)) <span class="keyword">if</span> len(input(<span class="string">"请输入您要发的端口："</span>)) <span class="keyword">else</span> <span class="number">8000</span></span><br><span class="line"></span><br><span class="line">    content = input(<span class="string">"请输入您要发的信息："</span>)</span><br><span class="line">    print(<span class="string">"你选择的是&#123;&#125;,端口:&#123;&#125;,内容为:&#123;&#125;"</span>.format(ip, port, content))</span><br><span class="line">    content = <span class="string">"\n"</span> + content</span><br><span class="line">    server.sendto(content.encode(),(ip, port))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recv_fun</span><span class="params">(server)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        recv_data, ip_port = server.recvfrom(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> recv_data:</span><br><span class="line">            data = dec_fun(recv_data)</span><br><span class="line">            print(<span class="string">'【新客户端发信息来了】'</span>, ip_port, <span class="string">'消息是:'</span>, data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"客户端可能中断"</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    udp_server_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">    udp_server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="literal">True</span>)</span><br><span class="line">    udp_server_socket.bind((<span class="string">""</span>, <span class="number">8000</span>))</span><br><span class="line"></span><br><span class="line">    t1 = threading.Thread(target=recv_fun, args=(udp_server_socket,))</span><br><span class="line">    t1.setDaemon(<span class="literal">True</span>)</span><br><span class="line">    t1.start()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        print(<span class="string">"*"</span> * <span class="number">20</span>)</span><br><span class="line">        print(<span class="string">"*"</span> * <span class="number">6</span>, <span class="string">'1 发送消息'</span>, <span class="string">"*"</span> * <span class="number">6</span>)</span><br><span class="line">        print(<span class="string">"*"</span> * <span class="number">6</span>, <span class="string">'2 退出系统'</span>, <span class="string">"*"</span> * <span class="number">6</span>)</span><br><span class="line">        print(<span class="string">"*"</span> * <span class="number">20</span>)</span><br><span class="line">        nums = input(<span class="string">"请输入您的选择:"</span>)</span><br><span class="line">        <span class="keyword">if</span> nums == <span class="string">"1"</span>:</span><br><span class="line">            send_fun(udp_server_socket)</span><br><span class="line">        <span class="keyword">elif</span> nums == <span class="string">"2"</span>:</span><br><span class="line">            print(<span class="string">"已经退出系统"</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"错误输入"</span>)</span><br></pre></td></tr></table></figure></div>

<h4 id="udp广播"><a href="#udp广播" class="headerlink" title="udp广播"></a>udp广播</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">udp_boradcast_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line">udp_boradcast_socket.setsockopt(socket.SOL_SOCKET, socket.SO_BROADCAST, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">udp_boradcast_socket.sendto(<span class="string">"I'm ZaG"</span>.encode(),(<span class="string">"255.255.255.255"</span>,<span class="number">3009</span>))</span><br><span class="line"></span><br><span class="line">udp_boradcast_socket.close()</span><br></pre></td></tr></table></figure></div>



<h4 id="进程以及状态"><a href="#进程以及状态" class="headerlink" title="进程以及状态"></a>进程以及状态</h4><h5 id="1-进程概念"><a href="#1-进程概念" class="headerlink" title="1.进程概念"></a>1.进程概念</h5><blockquote>
<p>进程是资源分配的最小单位  程序隔离的边界</p>
</blockquote>
<p><strong>程序是固定不变的，而进程会根据运行需要，让操作系统动态分配各种资源</strong></p>
<p><a href="/img/QQ20180913-010318@2x.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/img/QQ20180913-010318@2x.png" src="/img/loading.gif" class="lazyload"></a></p>
<p>cpu时间片轮转，不同时间切换执行不同进程，但是进程比较耗时，就引进轻量级进程，一个进程包含多个线程</p>
<h5 id="2-进程的状态"><a href="#2-进程的状态" class="headerlink" title="2.进程的状态"></a>2.进程的状态</h5><p>就绪态：运行的条件都已经满足，正在等cpu执行</p>
<p>执行态：cpu正在执行其功能</p>
<p>等待态：等待某些条件满足，例如一个程序sleep 此时处理等待态</p>
<h5 id="3-创建子进程"><a href="#3-创建子进程" class="headerlink" title="3.创建子进程"></a>3.创建子进程</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing,time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        print(<span class="string">'work1---'</span>, i)</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    p1 = multiprocessing.Process(group=<span class="literal">None</span>, target=work)</span><br><span class="line">    p1.start()</span><br><span class="line"> 	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        print(<span class="string">'这是主进程'</span>, i)</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure></div>

<p><strong>实例对象的常用方法</strong></p>
<p>start(): 启动子进程</p>
<p>is_alive():判断进程子进程是否还在活着</p>
<p>join(timeout): 是否等待子进程执行结束，或等待多少秒</p>
<p>terminate(): 不管任务是否完成，立即终止子进程</p>
<h5 id="进程名称，-pid"><a href="#进程名称，-pid" class="headerlink" title="进程名称， pid"></a>进程名称， pid</h5><p><strong>进程名称获取</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">multiprocessing.current_process()</span><br></pre></td></tr></table></figure></div>

<p><strong>进程pid</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 使用multiprocessing.current_process().pid</span></span><br><span class="line">multiprocessing.current_process().pid</span><br><span class="line"><span class="comment"># 2 使用import os 模块的getpid()</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.getpid()</span><br></pre></td></tr></table></figure></div>

<p><strong>获取父id</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getppid() 获取父进程id</span><br></pre></td></tr></table></figure></div>

<p><strong>进程参数，全局变量问题</strong></p>
<p>和线程传递参数基本一致</p>
<p><strong>进程间不共享全局变量</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line">num =<span class="number">100</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    print(<span class="string">"work num= %d"</span>%num)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work2</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"work2 num=%s"</span>%num)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    p1 = multiprocessing.Process(group=<span class="literal">None</span>, target=work,name=<span class="string">"MyProcess"</span>)</span><br><span class="line">    p1.start()</span><br><span class="line">    </span><br><span class="line">    p2 = multiprocessing.Process(group=<span class="literal">None</span>, target=work,name=<span class="string">"MyProcess2"</span>)</span><br><span class="line">    p2.start()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 结果： work num =101  work2 num =100</span></span><br></pre></td></tr></table></figure></div>

<h5 id="守护进程"><a href="#守护进程" class="headerlink" title="守护进程"></a>守护进程</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub_process</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        print(<span class="string">'子进程运行中'</span>)</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    p1 = multiprocessing.Process(group=<span class="literal">None</span>, target=sub_process, name=<span class="string">'p1'</span>)</span><br><span class="line">    <span class="comment"># 第一种方法</span></span><br><span class="line">    p1.daemon = <span class="literal">True</span></span><br><span class="line">    p1.start()</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"OVER"</span>)</span><br><span class="line">    <span class="comment"># 第二种方法</span></span><br><span class="line">    p1.terminate()</span><br><span class="line">    exit()</span><br></pre></td></tr></table></figure></div>



</div></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C/">网络    </a></div><div class="post_share"><div class="social-share" data-image="http://q78182iho.bkt.clouddn.com/19-01-25.jpg?e=1584259601&amp;token=PEtkS6wXfPIIvWRhdNmawy45lpr8NHmUxTk0LSsj:b8PjIDuqQVkvVNV9djSpVMd8JAw=&amp;attname=" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2018/03/29/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-2018-3-29-%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1%EF%BC%8C%E8%BF%9B%E7%A8%8B%E6%B1%A0%E4%BB%A5%E5%8F%8A%E8%BF%AD%E4%BB%A3%E5%99%A8/"><img class="prev_cover lazyload" data-src="http://q78182iho.bkt.clouddn.com/ide-cafe.jpg?e=1584259601&amp;token=PEtkS6wXfPIIvWRhdNmawy45lpr8NHmUxTk0LSsj:P_Kg5QdR4YOkOL5-dG7zoZ_iX5o=&amp;attname=" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Previous Post</div><div class="prev_info"><span>进程通信，进程池以及迭代器</span></div></a></div><div class="next-post pull_right"><a href="/2018/03/17/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-2018-3-17-%E5%B8%B8%E8%A7%81ftp-ssh%E6%90%AD%E5%BB%BA-%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-tcp-udp-socket%E7%BC%96%E7%A8%8B/"><img class="next_cover lazyload" data-src="http://q78182iho.bkt.clouddn.com/20181113.jpg?e=1584259601&amp;token=PEtkS6wXfPIIvWRhdNmawy45lpr8NHmUxTk0LSsj:vwxVDYac0pGJNqYcDLHPCg0iJt4=&amp;attname=" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>常见ftp，ssh搭建，网络基础知识，tcp，udp，socket编程</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2018/03/17/网络编程-2018-3-17-常见ftp-ssh搭建-网络基础知识-tcp-udp-socket编程/" title="常见ftp，ssh搭建，网络基础知识，tcp，udp，socket编程"><img class="relatedPosts_cover lazyload"data-src="http://q78182iho.bkt.clouddn.com/20181113.jpg?e=1584259601&token=PEtkS6wXfPIIvWRhdNmawy45lpr8NHmUxTk0LSsj:vwxVDYac0pGJNqYcDLHPCg0iJt4=&attname="><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-03-17</div><div class="relatedPosts_title">常见ftp，ssh搭建，网络基础知识，tcp，udp，socket编程</div></div></a></div><div class="relatedPosts_item"><a href="/2018/03/29/网络编程-2018-3-29-进程通信，进程池以及迭代器/" title="进程通信，进程池以及迭代器"><img class="relatedPosts_cover lazyload"data-src="http://q78182iho.bkt.clouddn.com/ide-cafe.jpg?e=1584259601&token=PEtkS6wXfPIIvWRhdNmawy45lpr8NHmUxTk0LSsj:P_Kg5QdR4YOkOL5-dG7zoZ_iX5o=&attname="><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-03-29</div><div class="relatedPosts_title">进程通信，进程池以及迭代器</div></div></a></div><div class="relatedPosts_item"><a href="/2018/04/02/网络编程-2018-4-2-迭代器-生成器-协程以及应用/" title="迭代器，生成器，协程以及应用"><img class="relatedPosts_cover lazyload"data-src="http://q78182iho.bkt.clouddn.com/n-750843.jpg?e=1584259601&token=PEtkS6wXfPIIvWRhdNmawy45lpr8NHmUxTk0LSsj:-Odd4OijwRQU0ECrI-FVLwSd2-w=&attname="><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-04-02</div><div class="relatedPosts_title">迭代器，生成器，协程以及应用</div></div></a></div></div><div class="clear_both"></div></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By ZaG Cool</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/click_heart.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>